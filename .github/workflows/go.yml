# This workflow will build a golang project
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-go

name: Go

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:

  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4

    - name: Set up Go
      uses: actions/setup-go@v4
      with:
        go-version: '1.20'

    - name: Build
      run: go build -v ./cmd/goshell/goshell.go 
    
    - name: Login to GitHub Container Registry (Optional)
      uses: docker/login@v3
      with:
        registry: ghcr.io
        username: ${{ github.repository_owner }}
        password: ${{ secrets.GH_TOKEN }} # Replace with your token

    - name: Build Docker Image
      run: |
        docker build -t ghcr.io/${{ github.repository }}/my-app:${{ github.sha }} .
        docker push ghcr.io/${{ github.repository }}/my-app:${{ github.sha }}

    - name: Scan Docker Image with Trivy
      uses: aquasecurity/trivy-action@master
      with:
       image-ref: ghcr.io/${{ github.repository }}/my-app:${{ github.sha }}
       scan-type: image
       format: sarif
       output: trivy.sarif

    - name: Gosec cloudbees action
      uses: cloudbees-io/gosec-plugin@v2
      with:
        cb_token: "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJBZVo5VmwzTEJYRUF5MjdDcnJ6Q1k1MjRvLUNwWklDdUoyQXYwU3pkV2FnIn0.eyJleHAiOjE3NDMwMDI4NDEsImlhdCI6MTc0MzAwMjcyMSwiYXV0aF90aW1lIjoxNzQzMDAyNzE4LCJqdGkiOiI3Y2I2Y2QzNS1hNjA1LTQwZDEtYTM1OS0zNjJmMDVmZjcyY2IiLCJpc3MiOiJodHRwczovL2lkLnNhYXMtcHJlcHJvZC5iZWVzY2xvdWQuY29tL3JlYWxtcy9jbG91ZGJlZXMiLCJhdWQiOlsicGxhdGZvcm0tYXBpIiwidWRzIiwiYWNjb3VudCJdLCJzdWIiOiJmOjg0OWMwYWIwLWI5MjItNGRlZC1iYzNkLTExNjg4OTJhMTVhNjpjM2U1NGEwMC1lMjhlLTExZWUtYjBkOC00MjAxMGE4M2FlOTIiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJuZXh0Z2VuLXVpIiwic2lkIjoiODViODM5MmQtY2ZkNi00N2E1LWFjZDQtNDZlMzk4ZjIwNGQ3IiwiYWNyIjoiMSIsImFsbG93ZWQtb3JpZ2lucyI6WyJodHRwczovL25leHRnZW4tdWkubG9jYWwuYmVlc2Nsb3VkOjgwODAiLCJodHRwczovL3NhYXMtcHJlcHJvZC5iZWVzY2xvdWQuY29tIl0sInJlYWxtX2FjY2VzcyI6eyJyb2xlcyI6WyJvZmZsaW5lX2FjY2VzcyIsInVtYV9hdXRob3JpemF0aW9uIl19LCJyZXNvdXJjZV9hY2Nlc3MiOnsiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJvcGVuaWQgcHJvZmlsZSBlbWFpbCIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJodHRwczovL3d3dy5jbG91ZGJlZXMuY29tL2VtcGxveWVlIjp0cnVlLCJodHRwczovL3d3dy5jbG91ZGJlZXMuY29tL3VzZXIvbWV0YWRhdGEiOnsiZW50aXRsZWRPcmdhbml6YXRpb25zIjpbeyJkb21haW4iOiJjbG91ZGJlZXMtcHJlcHJvZCIsIm5hbWUiOiJDbG91ZEJlZXMgUHJlcHJvZCIsImlkIjoiODUwOTg4OGUtZDI3Zi00NGZhLTQ2YTktMjliYzc2ZjVlNzkwIn0seyJkb21haW4iOiJ2aWduZXNoLXZlbGF5dXRoYW0tb3JnYW5pemF0aW9uIiwibmFtZSI6IlZpZ25lc2ggVmVsYXl1dGhhbSdzIG9yZ2FuaXphdGlvbiIsImlkIjoiMzc0Zjg3MjgtNGE0ZS00OWI1LTZlMjAtMjQ5MDMyOTk0YjU3In1dLCJhY3RpdmVPcmdhbml6YXRpb24iOnsiZW50aXRsZW1lbnRzIjpbeyJwcm9kdWN0RmFtaWx5IjoiU09GVFdBUkVfREVMSVZFUllfUExBVEZPUk0iLCJzdWJQcm9kdWN0RmFtaWx5IjoiIiwiaWQiOiIyNzg2MmJmZi1iMjEwLTQwMjgtODI5Ny0xNmUzODIyOWViYmMiLCJ0eXBlIjoiTUlOVVRFIn0seyJwcm9kdWN0RmFtaWx5IjoiU09GVFdBUkVfREVMSVZFUllfUExBVEZPUk0iLCJzdWJQcm9kdWN0RmFtaWx5IjoiIiwiaWQiOiIwN2FjNTU1Yy0zZTExLTQyMWUtOTIzNC00YjExMzRhMmFhOTUiLCJ0eXBlIjoiRk1fU0RLX0NMSUVOVCJ9LHsicHJvZHVjdEZhbWlseSI6IlNPRlRXQVJFX0RFTElWRVJZX1BMQVRGT1JNIiwic3ViUHJvZHVjdEZhbWlseSI6IiIsImlkIjoiOTVkMGZhOTEtMmZiYS00Nzg3LWI3ZDYtMjVlOWVhN2MxNGMyIiwidHlwZSI6Ik1BTkFHRV9ST0xFUyJ9LHsicHJvZHVjdEZhbWlseSI6IlNPRlRXQVJFX0RFTElWRVJZX1BMQVRGT1JNIiwic3ViUHJvZHVjdEZhbWlseSI6IiIsImlkIjoiNjlkZTZiNTYtMDVjYy00Y2YzLWJlM2YtYTVhMTI2YjQyYTMwIiwidHlwZSI6IlNVQk9SR0FOSVpBVElPTiJ9LHsicHJvZHVjdEZhbWlseSI6IlNPRlRXQVJFX0RFTElWRVJZX1BMQVRGT1JNIiwic3ViUHJvZHVjdEZhbWlseSI6IiIsImlkIjoiNGM5OWVjOTUtM2E5My00YzNlLWEzMWUtZDhlNTRkNTQyYWJmIiwidHlwZSI6Ik1BTkFHRURfQ09OVFJPTExFUiJ9LHsicHJvZHVjdEZhbWlseSI6IlNPRlRXQVJFX0RFTElWRVJZX1BMQVRGT1JNIiwic3ViUHJvZHVjdEZhbWlseSI6IiIsImlkIjoiYTliNjg2ZGMtYmQ4MS00MzY4LWE2ZTYtYTRlNTM5NTE1MjUxIiwidHlwZSI6IlBBUkFMTEVMX0pPQiJ9LHsicHJvZHVjdEZhbWlseSI6IlNPRlRXQVJFX0RFTElWRVJZX1BMQVRGT1JNIiwic3ViUHJvZHVjdEZhbWlseSI6IiIsImlkIjoiYmE4YWU0MzktZmE1ZS00NTU5LTg5ZmQtMmY1YWNhNDY4YmQzIiwidHlwZSI6IkFVRElUX09TX0lOVEVSVkFMIn0seyJwcm9kdWN0RmFtaWx5IjoiU09GVFdBUkVfREVMSVZFUllfUExBVEZPUk0iLCJzdWJQcm9kdWN0RmFtaWx5IjoiIiwiaWQiOiIzZTdjOTQ0ZS0wMGI1LTRlY2UtODhhOC1jZDdlODJmYzAzM2UiLCJ0eXBlIjoiU0VBVCJ9XSwiZG9tYWluIjoiY2xvdWRiZWVzLXByZXByb2QiLCJuYW1lIjoiQ2xvdWRCZWVzIFByZXByb2QiLCJpZCI6Ijg1MDk4ODhlLWQyN2YtNDRmYS00NmE5LTI5YmM3NmY1ZTc5MCJ9LCJ1c2VyX2lkIjoiYzNlNTRhMDAtZTI4ZS0xMWVlLWIwZDgtNDIwMTBhODNhZTkyIiwidG9rZW5WZXJzaW9uIjoiNC4wIiwidXNlcklkIjoiYzNlNTRhMDAtZTI4ZS0xMWVlLWIwZDgtNDIwMTBhODNhZTkyIiwibW9zdFJlY2VudE9yZ2FuaXphdGlvbiI6eyJlbnRpdGxlbWVudHMiOlt7InByb2R1Y3RGYW1pbHkiOiJTT0ZUV0FSRV9ERUxJVkVSWV9QTEFURk9STSIsInN1YlByb2R1Y3RGYW1pbHkiOiIiLCJpZCI6IjI3ODYyYmZmLWIyMTAtNDAyOC04Mjk3LTE2ZTM4MjI5ZWJiYyIsInR5cGUiOiJNSU5VVEUifSx7InByb2R1Y3RGYW1pbHkiOiJTT0ZUV0FSRV9ERUxJVkVSWV9QTEFURk9STSIsInN1YlByb2R1Y3RGYW1pbHkiOiIiLCJpZCI6IjA3YWM1NTVjLTNlMTEtNDIxZS05MjM0LTRiMTEzNGEyYWE5NSIsInR5cGUiOiJGTV9TREtfQ0xJRU5UIn0seyJwcm9kdWN0RmFtaWx5IjoiU09GVFdBUkVfREVMSVZFUllfUExBVEZPUk0iLCJzdWJQcm9kdWN0RmFtaWx5IjoiIiwiaWQiOiI5NWQwZmE5MS0yZmJhLTQ3ODctYjdkNi0yNWU5ZWE3YzE0YzIiLCJ0eXBlIjoiTUFOQUdFX1JPTEVTIn0seyJwcm9kdWN0RmFtaWx5IjoiU09GVFdBUkVfREVMSVZFUllfUExBVEZPUk0iLCJzdWJQcm9kdWN0RmFtaWx5IjoiIiwiaWQiOiI2OWRlNmI1Ni0wNWNjLTRjZjMtYmUzZi1hNWExMjZiNDJhMzAiLCJ0eXBlIjoiU1VCT1JHQU5JWkFUSU9OIn0seyJwcm9kdWN0RmFtaWx5IjoiU09GVFdBUkVfREVMSVZFUllfUExBVEZPUk0iLCJzdWJQcm9kdWN0RmFtaWx5IjoiIiwiaWQiOiI0Yzk5ZWM5NS0zYTkzLTRjM2UtYTMxZS1kOGU1NGQ1NDJhYmYiLCJ0eXBlIjoiTUFOQUdFRF9DT05UUk9MTEVSIn0seyJwcm9kdWN0RmFtaWx5IjoiU09GVFdBUkVfREVMSVZFUllfUExBVEZPUk0iLCJzdWJQcm9kdWN0RmFtaWx5IjoiIiwiaWQiOiJhOWI2ODZkYy1iZDgxLTQzNjgtYTZlNi1hNGU1Mzk1MTUyNTEiLCJ0eXBlIjoiUEFSQUxMRUxfSk9CIn0seyJwcm9kdWN0RmFtaWx5IjoiU09GVFdBUkVfREVMSVZFUllfUExBVEZPUk0iLCJzdWJQcm9kdWN0RmFtaWx5IjoiIiwiaWQiOiJiYThhZTQzOS1mYTVlLTQ1NTktODlmZC0yZjVhY2E0NjhiZDMiLCJ0eXBlIjoiQVVESVRfT1NfSU5URVJWQUwifSx7InByb2R1Y3RGYW1pbHkiOiJTT0ZUV0FSRV9ERUxJVkVSWV9QTEFURk9STSIsInN1YlByb2R1Y3RGYW1pbHkiOiIiLCJpZCI6IjNlN2M5NDRlLTAwYjUtNGVjZS04OGE4LWNkN2U4MmZjMDMzZSIsInR5cGUiOiJTRUFUIn1dLCJkb21haW4iOiJjbG91ZGJlZXMtcHJlcHJvZCIsIm5hbWUiOiJDbG91ZEJlZXMgUHJlcHJvZCIsImlkIjoiODUwOTg4OGUtZDI3Zi00NGZhLTQ2YTktMjliYzc2ZjVlNzkwIn19LCJuYW1lIjoiVmlnbmVzaCBWZWxheXV0aGFtIiwicHJlZmVycmVkX3VzZXJuYW1lIjoidnZlbGF5dXRoYW1AY2xvdWRiZWVzLmNvbSIsImdpdmVuX25hbWUiOiJWaWduZXNoIiwiZmFtaWx5X25hbWUiOiJWZWxheXV0aGFtIiwiZW1haWwiOiJ2dmVsYXl1dGhhbUBjbG91ZGJlZXMuY29tIn0.DnuFqOf4u4GAtvFMHjkNGJzMWbDrWEb-CzLgFJjZLfYyoGEWxC50t7Tn2kzCQJ5I3k-ioGZN4P3JzqAJCor4KdyDM3xd2Tmx9w59FLf0uijvbCoke5S514xiQu3pUWty3p4pauGM4heg8nr_uZON4lDociDZXuTlbXJT4M8H_Bwzf57zbb4MCT_HJyzEs-YknW_p9lr3TTEOyD0PnfzrO9d3Ccs0YelZcFJjHsbQpqdixo-N5YET7tGGv8KNCX5PfRXvh09O5NnvMH4LbcMpaXzgFzwM0O-PZCvgbx8loA3SSHxXkUyj7hnqiBlevKo8sk93Qx9jmLUDSODcZlKzIcv5gmEpROjaHYoZMDm0R4gPMw-HMHCa_tgGfOBsgNaobTqp6YjSESERtqDxHOVSXAnOgwlrNaX-ic0TsXV8bxvKkr_4-mx1YYoHRMpab6FgmHf24JuEoQZDxg--0viN6XdDXyavhN3NA3oXPTQphL3vo5mHAewTstcThA5AvHm-v3QJqqcF24Wv5-HnzWKo4tPjLgrIbPQc6PyT85csxuAwDC8pJ4u7pT_CXVr3B6t1pdSap-732e7A0YspAmwAoe97dF47F-n-R_btmqBi8YKsr3cAXz42yz5tETUX1TVg9SY8vqqUj9GkQRZRiioSrJo3EJMZirBos364uyysS_4"
        cb_api_url: "https://saas-preprod.beescloud.com/"
        gh_run_id: ${GITHUB_RUN_ID}"
        gh_job_id: ${GITHUB_JOB}"
        gh_step_id: ${GITHUB_STEP_NAME}"
